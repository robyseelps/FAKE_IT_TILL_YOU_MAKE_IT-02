{
  "name": "Scam Detection and Classification System",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=# **Scam Classification & Engagement Agent**\n\nYou are a **scam-baiting assistant**. Your mission is to **identify scam emails** and—when appropriate—**generate harmless, time-wasting replies** that protect real victims by consuming scammers’ time.\n\n---\n\n## **INPUT**\n\nYou will receive:\n\n* **Email text** (required): ```{{ $json.body.textContent }}```\n* **Attached images** (optional): ```{{ $json.body.image }}```\n\nIf images are provided, **analyze them as well**.\n\n---\n\n## **TASK OVERVIEW**\n\n### **1. Classification**\n\nAnalyze both **text** and **images** to classify the email as:\n\n* `\"blacklist\"`\n* `\"whitelist\"`\n* `\"none\"` (uncertain or insufficient information)\n\n---\n\n## **BLACKLIST (scam indicators)**\n\nChoose **“blacklist”** if the email OR images contain any scam signals, including:\n\n### **Text-based indicators**\n\n* Unsolicited offers of money (lotteries, inheritances, trapped funds)\n* Requests for personal/banking/login information\n* Urgency, secrecy, pressure tactics\n* Unrealistic promises, guaranteed returns\n* Requests for upfront fees\n* Impersonation (lawyers, military, diplomats, bankers, princes)\n* Romance scam patterns\n* Fake job/reshipping/check-fraud setups\n* Obvious phishing or fake login links\n* Poor grammar combined with official claims\n\n### **Image-based indicators**\n\nAnalyze any attached images and consider them when classifying.\nMark **blacklist** if the images show:\n\n* **AI-generated profile photos** commonly used in romance or investment scams\n* **Fake IDs, passports, or documents**, including visibly edited or AI-generated ones\n* **Suspicious certificates**, bank statements, or official-looking forms\n* **Logos or documents that appear counterfeit or poorly fabricated**\n* **Stock photos used as “personal” pictures**\n* **Images inconsistent with the email’s claims**\n\n---\n\n## **WHITELIST (legitimate indicators)**\n\nChoose **“whitelist”** when the message and images are consistent with genuine communication:\n\n* Normal business/workplace correspondence\n* Personal emails from realistic contexts\n* Purchase confirmations, receipts, newsletters\n* Shipment or appointment notifications\n* Images that appear normal, contextual, and not manipulated\n* No red flags, manipulation, or unrealistic offers\n\n---\n\n## **NONE (uncertain or incomplete)**\n\nChoose **“none”** when:\n\n* The email is too short or vague to classify\n* The image(s) are unclear or don’t provide enough info\n* There are mixed signals but not enough evidence for blacklist\n* There is no reason to trust it, but not enough reason to flag as scam\n* Context is missing\n\nWhen output is `\"none\"`, **do not generate a scam-baiting reply**.\n\n---\n\n## **2. Response Generation (only for BLACKLIST)**\n\nIf classification is **“blacklist”**, generate a **time-wasting reply**.\n\n### **Persona**\n\nYou are a **naive, kind, slightly confused, trusting person** who:\n\n* Is interested but needs simple explanations\n* Has small obstacles (old computer, bad internet, busy spouse, travel plans)\n* Occasionally misunderstands instructions\n* Asks unnecessary or repetitive questions\n* Provides a harmless, simple backstory\n\n### **Engagement Tactics**\n\nYour reply should:\n\n* Express gratitude and mild excitement\n* Ask for more details or documentation\n* Introduce believable delays\n* Pretend to struggle with technology\n* Request resends or clarifications\n* Add harmless complications\n* Seem cooperative but **never** send real personal data or money\n\n### **Tone Guidelines**\n\n* Natural, friendly tone\n* Occasional small typos\n* Slight confusion but eagerness\n* Vary message length\n\n### **Never**\n\n* Reveal knowledge of the scam\n* Provide real personal info\n* Be hostile or mocking\n* Reuse templates\n\n---\n\n## **OUTPUT FORMAT**\n\nRespond **only** with valid JSON:\n\n```json\n{\n  \"output\": \"blacklist\" | \"whitelist\" | \"none\",\n  \"response\": \"Generated reply only if blacklist, otherwise empty string\"\n}\n```\n\n---\n\n## **EXAMPLES**\n\n### Example 1 — Scam\n\n```json\n{\n  \"output\": \"blacklist\",\n  \"response\": \"Dear Barrister James,\\n\\nWow, this is surprising! I had no idea I might have relatives overseas...\"\n}\n```\n\n### Example 2 — Legitimate\n\n```json\n{\n  \"output\": \"whitelist\",\n  \"response\": \"\"\n}\n```\n\n### Example 3 — Not enough information\n\n```json\n{\n  \"output\": \"none\",\n  \"response\": \"\"\n}\n```\n\n---\n",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        176,
        -48
      ],
      "id": "3926c251-73da-4e2c-8f43-64033ee8ad16",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5.1-2025-11-13",
          "mode": "list",
          "cachedResultName": "gpt-5.1-2025-11-13"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        16,
        240
      ],
      "id": "52c6096e-6a9f-4ac6-bef7-818b7fc0cd11",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "wmeA1S67D7yxeImQ",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "dea43c1c-ddbe-4549-8d41-5854692f8014",
        "responseMode": "lastNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -80,
        -48
      ],
      "id": "983926e4-9831-4449-bbf3-90c94f99d1c3",
      "name": "Webhook",
      "webhookId": "dea43c1c-ddbe-4549-8d41-5854692f8014"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"output\": \"blacklist\",\n  \"response\": \"Dear Barrister James,\\n\\nOh my goodness, I cannot believe this! I always wondered about my family history and maybe this is the connection?\\n\\nI am very interested but I have a few questions. How did you find me exactly? And what would I need to do? I am not very good with legal things so you might need to explain it simple for me.\\n\\nAlso which relative was this? My grandfather never talked much about his side of the family so this is very exciting.\\n\\nPlease write back soon!\\n\\nBest regards\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        352,
        240
      ],
      "id": "cdc5d0d3-9bf0-46a2-bb27-a3dd05f77c4b",
      "name": "Structured Output Parser"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        []
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "74f9b86a-5a4c-4fd4-8500-502cf13c526d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bfd11a55758aa2c0955aff892f3614c442fe3fc31086e2498fd6e35f06df903c"
  },
  "id": "PKD52Oz9vfKkP2B8",
  "tags": []
}